var stages = {
  'init':{
    action:function(){
    },
    to:[{
      label:'load-config',
      beforeNext:function(next){
        next();
      },
    }],
  },
  'load-config':{
    action:function(){
      load('Config');
      sendConfig();
    },
    to:[{
      label:'display-config',
      beforeNext:function(next){
        loadDone(JSON.stringify(vm.config,null,2));
        next();
      },
    }],
  },
  'display-config':{
    action:function(){
      resetConfig();
    },
    to:[{
      label:'modify-list',
      beforeNext:function(next){
        log('');
        setCanCommitSheetId(false);
        next();
      },
    }],
  },
  'modify-list':{
    action:function(){
      resetSheetId('list');
    },
    to:[{
      label:'modify-list',
      beforeNext:function(next){
        load('Load list');
        loadSheetId(function(is_okay, logs){
          loadDone(logs);
          setCanCommitSheetId(is_okay);
          next();
        });
      },
    },{
      label:'modify-dates',
      beforeNext:function(next){
        log('');
        commitListSheetId();
        resetSheetId();
        setCanCommitSheetId(false);
        next(true);
      },
    }],
  },
  'modify-dates':{
    action:function(reload){
      if(reload){
        load('Load dates');
        loadAllSheetDates(function(is_okay, logs){
          loadDone(is_okay? 'Pick target dates': logs);
        });
      }
    },
    to:[{
      label:'modify-dates',
      beforeNext:function(next){
        load('Load attendance');
        loadSheetId(function(is_okay, logs){
          loadDone(logs);
          setCanCommitSheetId(is_okay);
          next(false);
        });
      },
    },{
      label:'preview-config',
      beforeNext:function(next){
        log('');
        next();
      },
    },{
      label:'modify-dates',
      beforeNext:function(next){
        log('');
        commitAttendanceSheetId();
        resetSheetId();
        setCanCommitSheetId(false);
        next(true);
      },
    }],
  },
  'preview-config':{
    action:function(){
      log(JSON.stringify(vm.tested_config, null, 2));
    },
    to:[{
      label:'',
      beforeNext:function(){
        commitSheetDates();
      },
    }],
  },
  /*
  '':{
    action:function(){
    },
    to:[{
      label:'',
      beforeNext:function(){
      },
    }],
  },
  '':{
    action:function(){
    },
    to:[{
      label:'',
      beforeNext:function(){
      },
    }],
  },
  '':{
    action:function(){
    },
    to:[{
      label:'',
      beforeNext:function(){
      },
    }],
  },
  '':{
    action:function(){
    },
    to:[{
      label:'',
      beforeNext:function(){
      },
    }],
  },
  */
};
